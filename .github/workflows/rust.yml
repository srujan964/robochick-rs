---
env:
  CARGO_TERM_COLOR: always
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Initalize env file
      run: |
        touch .env.test
        echo TWITCH_CLIENT_ID="client-id" >> .env.test
        echo TWITCH_EVENTSUB_SUBSCRIPTION_SECRET="chickencoop" >> .env.test
        echo TWITCH_CHANNEL_ID="test_channel_id" >> .env.test
        echo TWITCH_HOST="httpL//localhost:3696/twitch/" >> .env.test
        echo SE_API_HOST="http://localhost:3000/streamelements/" >> .env.test
        echo FEED_MODS_REWARD_ID="92af127c-7326-4483-a52b-b0da0be61c01" >> .env.test
        echo BROADCASTER_USER_ID=1337 >> .env.test
        echo REDIRECT_URI="http://localhost:3696/twitch/oauth" >> .env.test
        echo MESSAGE_COMPONENTS_CONFIG_PATH="resources/config/message_components.json" >> .env.test
    - name: Build
      run: cargo build
    - name: Run tests
      run: cargo test
      env:
        TWITCH_CLIENT_SECRET: ${{ secrets.TWITCH_CLIENT_SECRET }}
        SE_JWT: ${{ secrets.SE_JWT }}
        AWS_SESSION_TOKEN: ${{ secrets.AWS_SESSION_TOKEN }}

name: Rust
'on':
  pull_request:
    branches: [ "main" ]
  push:
    branches: [ "main" ]
